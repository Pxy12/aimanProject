# 中国指数网数据获取与解密项目需求文档

## 1. 项目概述

本项目旨在开发一个自动化工具，用于从中国指数网获取娱乐频道数据，处理请求签名生成，并解密返回的加密数据。项目通过Python和JavaScript的混合编程实现，支持多频道数据获取，并提供数据保存功能。

## 2. 功能需求

### 2.1 频道数据获取
- 支持配置不同的频道参数（如'movielist'、'varietylist'、'爱情'等）
- 能够发送HTTP GET请求到指定API获取数据
- 支持自定义请求参数、Cookie和请求头

### 2.2 签名生成
- 使用Node.js执行JavaScript代码
- 调用`signDecrypt.js`文件中的`Ny`函数生成请求签名
- 支持传递自定义URL信息、数据信息和其他参数
- 提供签名生成失败时的备用机制

### 2.3 数据解密
- 自动检测API返回数据是否加密
- 如数据加密，调用`dataDecrypt.js`文件中的`dataFilter`函数进行解密
- 支持解密各种格式的加密数据

### 2.4 结果处理
- 将解密后的数据以JSON格式保存到文件
- 文件命名包含频道标识，以便区分不同频道的数据
- 提供详细的控制台日志输出

## 3. 非功能需求

### 3.1 性能要求
- 签名生成和解密过程响应时间应在合理范围内（不超过60秒）
- 程序应能够处理大量数据而不崩溃

### 3.2 可靠性
- 程序应具备完善的错误处理机制
- 当签名生成失败时，应使用备用签名继续执行
- 当解密失败时，应提供清晰的错误信息

### 3.3 可维护性
- 代码结构清晰，易于理解和修改
- 提供详细的注释和文档
- 支持通过简单配置修改获取不同频道的数据

### 3.4 兼容性
- 支持在Windows操作系统上运行
- 兼容Python 3.6及以上版本
- 兼容不同版本的Node.js

## 4. 技术规范

### 4.1 开发语言
- **Python**：用于主要程序逻辑和HTTP请求
- **JavaScript**：用于签名生成和解密功能

### 4.2 依赖库
- **Python库**：
  - requests：用于发送HTTP请求
  - json：用于JSON数据处理
  - subprocess：用于执行外部命令
  - os, sys：用于系统操作和环境配置
- **JavaScript环境**：
  - Node.js：用于执行JavaScript代码

### 4.3 外部文件依赖
- **signDecrypt.js**：包含`Ny`函数，用于生成请求签名
- **dataDecrypt.js**：包含`dataFilter`函数，用于解密数据

## 5. 实现细节

### 5.1 签名生成流程
1. 构建JavaScript代码，加载`signDecrypt.js`文件
2. 注入必要的全局对象（window、document、navigator、location）
3. 检查`Ny`函数是否存在
4. 调用`Ny(urlInfo, dataInfo, otherInfo)`生成签名
5. 解析并返回签名结果

### 5.2 数据解密流程
1. 检测API响应中的`isEncrypt`标志
2. 如需要解密，准备解密参数
3. 构建JavaScript代码，加载`dataDecrypt.js`文件
4. 注入必要的全局对象
5. 检查`dataFilter`函数是否存在
6. 调用`dataFilter(encryptedData)`解密数据
7. 解析并返回解密结果

### 5.3 错误处理机制
- 签名生成失败时，使用固定备用签名
- JavaScript执行出错时，捕获并记录错误信息
- 文件操作和网络请求异常时，提供详细的错误提示

## 6. 配置项说明

### 6.1 频道配置
- **word变量**：设置需要获取的频道，如'movielist'、'varietylist'、'爱情'等

### 6.2 请求配置
- **URL信息**：API路径和请求方法
- **数据信息**：包含频道参数等请求数据
- **Cookie和请求头**：用于模拟浏览器请求

### 6.3 文件路径配置
- **输出文件命名**：`decrypted_result_{word}.json`，自动包含频道标识

## 7. 测试要求

### 7.1 功能测试
- 测试不同频道参数的数据获取功能
- 测试签名生成功能的正确性
- 测试数据解密功能的有效性
- 测试结果保存功能

### 7.2 错误场景测试
- 测试签名生成失败时的备用机制
- 测试解密失败时的错误处理
- 测试网络请求异常时的行为

## 8. 部署说明

### 8.1 环境准备
- 安装Python 3.6+
- 安装Node.js
- 安装Python依赖：`pip install -r requirements.txt`

### 8.2 文件部署
- 确保`decrypt.py`、`signDecrypt.js`和`dataDecrypt.js`在同一目录
- 根据需要修改配置参数

### 8.3 运行方式
- 直接运行：`python decrypt.py`
- 或在Python环境中执行脚本

## 9. 维护与更新

### 9.1 Cookie和请求头更新
- 定期更新Cookie以确保请求有效性
- 根据网站变化调整请求头

### 9.2 JavaScript文件维护
- 当网站更新加密算法时，需要更新`signDecrypt.js`和`dataDecrypt.js`

### 9.3 功能扩展
- 可根据需要扩展支持更多API和数据类型
- 可增加数据处理和分析功能

## 10. 安全考虑

### 10.1 数据安全
- 确保保存的解密数据符合相关法律法规
- 不存储敏感个人信息

### 10.2 API访问
- 遵守网站的robots.txt和使用条款
- 避免过度频繁请求导致IP被封禁